# Connect4 人機對戰系統使用指南

## 🎮 概述

這個系統提供了完整的Connect4人機對戰功能，支援多種AI對手，讓你可以測試訓練好的AI agent的實際表現。

## 🚀 快速開始

### 基本對戰遊戲
```bash
uv run python human_vs_ai_game.py
```

### 快速測試RL模型
```bash
uv run python test_rl_agent.py
```

## 🤖 AI對手類型

### 1. 隨機AI (簡單)
- 隨機選擇有效動作
- 適合初學者練習
- 勝率預期: 很容易獲勝

### 2. 中央偏好AI (普通)
- 偏好下在中央列 (3, 4, 2, 5, 1, 6, 0)
- 有基本策略但不完美
- 勝率預期: 中等難度

### 3. C4Solver完美AI (困難)
- 使用完美算法求解
- 從開局書載入最優開局
- 勝率預期: 非常困難，幾乎不可能獲勝

### 4. 訓練的RL模型 (自定義)
- 載入你訓練的強化學習模型
- 性能取決於訓練質量
- 這是主要的測試對象

## 📁 模型文件管理

### 自動檢測模型
系統會自動在以下位置尋找模型:
- `checkpoints/` 目錄中的 `.pt` 文件
- 當前目錄中包含 `model` 的 `.pt` 文件

### 推薦的模型命名
```
checkpoints/
├── best_model_wr_0.533.pt    # 勝率53.3%的最佳模型
├── best_model_wr_0.467.pt    # 勝率46.7%的模型
└── latest_checkpoint.pt      # 最新檢查點
```

## 🎯 遊戲功能

### 基本操作
- 輸入列號 `0-6` 來下棋
- 輸入 `q` 退出遊戲
- 遊戲會顯示有效的可選列

### 局面分析 (可選)
開啟分析模式會顯示:
- 當前玩家信息
- 可下位置
- 移動歷史
- 戰術提示 (獲勝機會、防守需求)

### 遊戲統計
遊戲結束後會顯示:
- 獲勝者
- 總移動數
- 完整移動歷史
- AI對手信息

## 🔧 測試RL Agent的建議

### 1. 漸進式測試
```bash
# 先對戰簡單AI熱身
選擇對手: 1 (隨機AI)

# 然後測試中等難度
選擇對手: 2 (中央偏好AI)

# 最後挑戰你的RL模型
選擇對手: 4 (RL模型)

# 終極挑戰完美AI
選擇對手: 3 (C4Solver)
```

### 2. 多局測試
- 進行多局遊戲觀察一致性
- 注意AI在不同局面下的表現
- 觀察是否學會了基本戰術 (阻擋、連攻)

### 3. 分析AI行為
開啟局面分析模式觀察:
- AI是否識別威脅
- 是否優先防守
- 是否有長期戰略

### 4. 性能指標
觀察AI的信心分數:
- 🎯 高信心 (>80%): AI非常確定這步棋
- 🤔 中信心 (50-80%): AI有一定把握
- 🎲 低信心 (<50%): AI不太確定，可能是隨機選擇

## 🛠️ 故障排除

### 模型載入失敗
```
❌ 無法載入RL模型: ...
```
**解決方案:**
1. 檢查模型文件路徑是否正確
2. 確認模型架構匹配 (input_size=126, hidden_size等)
3. 檢查PyTorch版本兼容性

### C4Solver未找到
```
❌ C4Solver not found at: connect4/c4solver
```
**解決方案:**
1. 確認 `connect4/c4solver` 可執行文件存在
2. 檢查文件權限: `chmod +x connect4/c4solver`
3. 重新編譯C4Solver (如果需要)

### 依賴缺失
```
ModuleNotFoundError: No module named 'torch'
```
**解決方案:**
使用 `uv run` 而不是直接 `python`:
```bash
uv run python human_vs_ai_game.py
```

## 📊 評估RL Agent質量

### 好的RL Agent應該:
1. ✅ 能穩定擊敗隨機AI (>90%勝率)
2. ✅ 能擊敗中央偏好AI (>70%勝率)
3. ✅ 識別並阻擋對手的獲勝威脅
4. ✅ 主動創造自己的獲勝機會
5. ✅ 在相似局面下行為一致

### 需要改進的跡象:
1. ❌ 經常錯過明顯的獲勝機會
2. ❌ 無法阻擋對手的威脅
3. ❌ 行為過於隨機，缺乏策略性
4. ❌ 信心分數始終很低
5. ❌ 在優勢局面下崩盤

## 🎪 進階用法

### 自定義測試
你可以修改 `human_vs_ai_game.py` 來:
- 調整AI思考時間
- 添加更多分析功能
- 實現AI vs AI自動對戰
- 記錄詳細的遊戲日誌

### 批量測試
```python
# 實現多局自動測試來評估勝率
for i in range(100):
    # 自動對戰並記錄結果
    pass
```

## 🎯 總結

這個人機對戰系統讓你可以:
- 🎮 直觀地測試RL agent的實際表現
- 🧠 觀察AI的決策過程和戰略思維
- 📊 通過多種難度對手評估AI水平
- 🔧 發現並改進AI的弱點

享受與你的AI agent對戰吧! 🚀
